## Wire Mock stub platform

Платформа предназначена для создания mock сервисов

Более полную информацию по дукументации можно получить здесь: http://wiremock.org/docs/

## Описание конфигурации

stub-runner.jar -  является standalone приложением, который запускается как обычное java приложение, 
на определенном порту (по умолчанию 8080) (доп. параметры конфигурации можно посмотреть в офф.документации)

Директории mappings и __files являются основными для приложения: в них расположены т.н. "стабы" сервисов, описанные 
в json формате. В директории __files расположены в основном файлы  с телом запроса/ответа. 

### Правила конфигурирования стабов

Для упрощения конфигурации стабов, рекомендуется (= обязательно. чтоб не заблудится) 
разделять стабы логически по отдельным директориям. 

Например: 
* auth-service - стаб для ац
* session-context - стаб для MSA 
* spm - стаб для СПМ

Описание конфигурации стабов для конкретных http endpoints размещены в json файлах. 

Пример описания 1-го кейса: 

        {
            "request": {
                "method": "POST", 
                "url": "/auth-service/authentication/deviceToken",
                "bodyPatterns" : [ {
                    "matchesJsonPath" : "$.[?(@.deviceTokenId == '0000900100000000223402')]"
                } ]
            },
            "response": {
                "status": 401,
                "jsonBody": {
                    "exception": "IncorrectPinException",
                    "message": "Ошибка аутентификации",
                    "remainingPinAttempts": 2
                },
                "headers": {
                    "Content-Type": "application/json"
                }
            }
        }
        

Доп.информацию по конифгурированию поведения стаба  см. в документации по ссылке, указанной выше. 

### Разграничение стабов по директориям и префиксам в url

Чтобы избежать неоднозначности при маппинге стабов на конкретные url, необходимо придерживаться разделения по 
префиксам в url строке. 

Например, 

    "url": "/auth-service/authentication/deviceToken",

В данном случае означает, что данное описание стаба относится к сервису auth-service. 
т.к. мы располагает запросы каждого стаба в директории, отведенной ему (например auth-service, spm и тд), то желательно, чтоб 
название директории и префикса сервис в url совпадали. 

### Base url стабов

* http://host:port/auth-service - для АЦ
* http://host:port/spm - для СПМ
* http://host:port/session-context - для MSA


Данные адреса необходимо указывать в целевой системе, кто будет обращаться


## Запуск 

Пример запуска приложения из консоли: 
    
    java -jar stub-runner.jar 
    
    

## Админка сервиса

Сервис поддерживает возможность управления стабами через админ-консоль, доступную через swagger 

Адрес для перехода: (host и port - укажите реальные данные)

    http://host:port/__admin/docs/


## Добавление новых стабов

При добавлении новых стабов через json файлы сервис необходимо будет перезапустить. 

При добавлении новых стабов через админку - перезапуск не требуется. (данный способ добавления нежелателен, так как
стабы пропадут после перезапуска сервиса)